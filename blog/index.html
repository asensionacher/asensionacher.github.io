---
layout: default
title: Blog
description: Not√≠cies, activitats i esdeveniments de l'AFA Bernat Desclot. Descobreix les √∫ltimes actualitzacions, sortides, tallers i celebracions de la nostra comunitat escolar.
image: /assets/images/logo-bernat-desclot-camiseta-amarilla.webp
---

<div class="page-header">
    <div class="container">
        <h1 data-i18n="blog.page_title">Blog</h1>
        <p class="page-subtitle" data-i18n="blog.page_subtitle">Not√≠cies, activitats i esdeveniments de l'AFA</p>
    </div>
</div>

<div class="blog-main">
    <div class="container">
        <!-- Filters Section -->
        <div class="blog-filters">
            <div class="filter-group">
                <h3 class="filter-title" data-i18n="blog.filter_by_tag">Filtrar per etiqueta</h3>
                <div class="tag-filters" id="tag-filters">
                    <button class="filter-tag active" data-tag="all" data-i18n="blog.all_tags">Tots</button>
                    {% assign all_tags = site.posts | map: 'tags' | join: ',' | split: ',' | uniq | sort %}
                    {% for tag in all_tags %}
                    <button class="filter-tag" data-tag="{{ tag | strip }}" data-tag-original="{{ tag | strip }}">{{ tag | strip }}</button>
                    {% endfor %}
                </div>
            </div>
            
            <div class="filter-group">
                <h3 class="filter-title" data-i18n="blog.filter_by_year">Filtrar per any</h3>
                <div class="date-filters">
                    <select id="year-filter" class="date-select">
                        <option value="all" data-i18n="blog.all_years">Tots els anys</option>
                        {% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" %}
                        {% for year_group in posts_by_year %}
                        <option value="{{ year_group.name }}">{{ year_group.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button id="clear-filters" class="btn-clear-filters" data-i18n="blog.clear_filters">Esborrar filtres</button>
                <span id="results-count" class="results-count"></span>
            </div>
        </div>

        <!-- Posts Grid -->
        <div class="blog-grid" id="posts-grid">
            {% assign pinned_posts = site.posts | where: "pinned", true %}
            {% assign regular_posts = site.posts | where_exp: "post", "post.pinned != true" %}
            {% assign all_posts = pinned_posts | concat: regular_posts %}
            {% for post in all_posts %}
            <article class="blog-card{% if post.pinned %} blog-card-pinned{% endif %}" 
                     data-post-id="{{ post.id | slugify }}"
                     data-tags="{{ post.tags | join: ',' }}"
                     data-date="{{ post.date | date: '%Y-%m-%d' }}"
                     data-year="{{ post.date | date: '%Y' }}"
                     data-pinned="{{ post.pinned }}">
                <div class="blog-card-header">
                    {% if post.pinned %}<span class="pinned-badge" title="Destacat">‚≠ê</span>{% endif %}
                    <span class="blog-date">üìÖ {{ post.date | date: "%d/%m/%Y" }}</span>
                    {% if post.tags %}
                    <div class="blog-tags">
                        {% for tag in post.tags %}
                        <span class="tag clickable-tag" data-tag="{{ tag }}">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <h2 class="blog-card-title">
                    <a href="{{ post.url | relative_url }}" class="post-title-link">{{ post.title }}</a>
                </h2>
                <p class="blog-card-excerpt post-description">
                    {{ post.description | default: post.excerpt | strip_html | truncate: 150 }}
                </p>
                <a href="{{ post.url | relative_url }}" class="read-more" data-i18n="blog.read_more">Llegir m√©s ‚Üí</a>
            </article>
            {% endfor %}
        </div>

        {% if site.posts.size == 0 %}
        <div class="no-posts">
            <p data-i18n="blog.no_posts">Encara no hi ha articles al blog.</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Post translations
(function() {
    window.postTranslations = {
        {% for post in site.posts %}
        "{{ post.id | slugify }}": {
            {% if post.translations %}
            {% for lang_data in post.translations %}
            "{{ lang_data[0] }}": {
                "title": {{ lang_data[1].title | jsonify }},
                "description": {{ lang_data[1].description | jsonify }},
                "tags": {{ lang_data[1].tags | jsonify }}
            }{% unless forloop.last %},{% endunless %}
            {% endfor %}
            {% endif %}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    };
    
    // Build tag translations map from all posts
    window.tagTranslations = {};
    {% for post in site.posts %}
        {% if post.translations %}
            {% for lang_data in post.translations %}
                {% if lang_data[1].tags %}
                    {% for tag in lang_data[1].tags %}
                        {% assign tag_index = forloop.index0 %}
                        {% assign original_tag = post.tags[tag_index] %}
                        {% if original_tag %}
    if (!window.tagTranslations["{{ original_tag }}"]) {
        window.tagTranslations["{{ original_tag }}"] = {};
    }
    window.tagTranslations["{{ original_tag }}"]["{{ lang_data[0] }}"] = {{ tag | jsonify }};
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endfor %}

    // Function to update post titles, descriptions and tags based on language
    window.updatePostTranslations = function(lang) {
        // Update posts
        document.querySelectorAll('[data-post-id]').forEach(card => {
            const postId = card.getAttribute('data-post-id');
            const translations = window.postTranslations[postId];
            
            if (translations && translations[lang]) {
                const titleLink = card.querySelector('.post-title-link');
                const description = card.querySelector('.post-description');
                const tagsContainer = card.querySelector('.blog-tags');
                
                if (titleLink && translations[lang].title) {
                    titleLink.textContent = translations[lang].title;
                }
                
                if (description && translations[lang].description) {
                    description.textContent = translations[lang].description;
                }
                
                if (tagsContainer && translations[lang].tags) {
                    const tags = tagsContainer.querySelectorAll('.tag');
                    translations[lang].tags.forEach((tagText, index) => {
                        if (tags[index]) {
                            tags[index].textContent = tagText;
                        }
                    });
                }
            }
        });
        
        // Update filter buttons
        document.querySelectorAll('.filter-tag[data-tag-original]').forEach(button => {
            const originalTag = button.getAttribute('data-tag-original');
            if (window.tagTranslations[originalTag] && window.tagTranslations[originalTag][lang]) {
                button.textContent = window.tagTranslations[originalTag][lang];
            }
        });
    };

    // Ensure the function runs after main.js has loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const currentLang = localStorage.getItem('preferredLanguage') || 'ca';
                if (window.updatePostTranslations) {
                    window.updatePostTranslations(currentLang);
                }
            }, 100);
        });
    } else {
        setTimeout(function() {
            const currentLang = localStorage.getItem('preferredLanguage') || 'ca';
            if (window.updatePostTranslations) {
                window.updatePostTranslations(currentLang);
            }
        }, 100);
    }
})();

// ============================================
// Blog Filtering Functionality
// ============================================
(function() {
    let activeTags = []; // Changed to array for multiple tags
    let activeYear = 'all';
    
    function initFilters() {
        const tagButtons = document.querySelectorAll('.filter-tag');
        const yearSelect = document.getElementById('year-filter');
        const clearButton = document.getElementById('clear-filters');
        const clickableTags = document.querySelectorAll('.clickable-tag');
        
        // Tag filter buttons
        tagButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tag = this.getAttribute('data-tag');
                toggleTagFilter(tag);
            });
        });
        
        // Clickable tags in posts
        clickableTags.forEach(tag => {
            tag.addEventListener('click', function(e) {
                e.preventDefault();
                const tagName = this.getAttribute('data-tag');
                toggleTagFilter(tagName);
                // Scroll to filters
                document.querySelector('.blog-filters').scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
        
        // Year filter
        if (yearSelect) {
            yearSelect.addEventListener('change', function() {
                activeYear = this.value;
                filterPosts();
            });
        }
        
        // Clear filters button
        if (clearButton) {
            clearButton.addEventListener('click', function() {
                clearAllFilters();
            });
        }
        
        // Initial filter (check for URL parameters)
        checkUrlParameters();
        filterPosts();
    }
    
    function toggleTagFilter(tag) {
        if (tag === 'all') {
            // Clear all tag filters
            activeTags = [];
            document.querySelectorAll('.filter-tag').forEach(btn => {
                if (btn.getAttribute('data-tag') === 'all') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        } else {
            // Toggle the specific tag
            const index = activeTags.indexOf(tag);
            if (index > -1) {
                // Tag is active, remove it
                activeTags.splice(index, 1);
            } else {
                // Tag is not active, add it
                activeTags.push(tag);
            }
            
            // Update button states
            document.querySelectorAll('.filter-tag').forEach(btn => {
                const btnTag = btn.getAttribute('data-tag');
                if (btnTag === 'all') {
                    btn.classList.toggle('active', activeTags.length === 0);
                } else if (btnTag === tag) {
                    btn.classList.toggle('active');
                } else if (activeTags.includes(btnTag)) {
                    btn.classList.add('active');
                }
            });
        }
        
        filterPosts();
    }
    
    function filterPosts() {
        const postsGrid = document.getElementById('posts-grid');
        const posts = Array.from(document.querySelectorAll('.blog-card'));
        let visibleCount = 0;
        
        // Separate pinned and regular posts
        const pinnedPosts = [];
        const regularPosts = [];
        
        posts.forEach(post => {
            const postTags = post.getAttribute('data-tags').split(',').map(t => t.trim());
            const postYear = post.getAttribute('data-year');
            const isPinned = post.getAttribute('data-pinned') === 'true';
            
            let showPost = true;
            
            // Filter by tags (show post if it has ANY of the selected tags)
            if (activeTags.length > 0) {
                const hasMatchingTag = activeTags.some(tag => postTags.includes(tag));
                if (!hasMatchingTag) {
                    showPost = false;
                }
            }
            
            // Filter by year
            if (activeYear !== 'all' && postYear !== activeYear) {
                showPost = false;
            }
            
            // Show/hide post
            if (showPost) {
                post.style.display = 'block';
                visibleCount++;
                // Separate into pinned and regular arrays
                if (isPinned) {
                    pinnedPosts.push(post);
                } else {
                    regularPosts.push(post);
                }
            } else {
                post.style.display = 'none';
            }
        });
        
        // Reorder posts: pinned first, then regular
        const orderedPosts = [...pinnedPosts, ...regularPosts];
        orderedPosts.forEach(post => {
            postsGrid.appendChild(post);
        });
        
        // Update results count
        updateResultsCount(visibleCount);
        
        // Show/hide no results message
        const noResultsMsg = document.querySelector('.no-results-message');
        if (visibleCount === 0) {
            if (!noResultsMsg) {
                const msg = document.createElement('div');
                msg.className = 'no-results-message';
                msg.setAttribute('data-i18n', 'blog.no_results');
                msg.textContent = 'No s\'han trobat articles amb aquests filtres.';
                postsGrid.appendChild(msg);
            }
        } else {
            if (noResultsMsg) {
                noResultsMsg.remove();
            }
        }
    }
    
    function updateResultsCount(count) {
        const resultsCount = document.getElementById('results-count');
        if (resultsCount) {
            const lang = localStorage.getItem('preferredLanguage') || 'ca';
            const translations = {
                ca: count === 1 ? '1 article trobat' : `${count} articles trobats`,
                es: count === 1 ? '1 art√≠culo encontrado' : `${count} art√≠culos encontrados`,
                en: count === 1 ? '1 article found' : `${count} articles found`,
                ar: count === 1 ? 'ŸÖŸÇÿßŸÑÿ© Ÿàÿßÿ≠ÿØÿ©' : `${count} ŸÖŸÇÿßŸÑÿßÿ™`,
                ur: count === 1 ? '1 ŸÖÿ∂ŸÖŸàŸÜ' : `${count} ŸÖÿ∂ÿßŸÖ€åŸÜ`
            };
            resultsCount.textContent = translations[lang] || translations.ca;
        }
    }
    
    function clearAllFilters() {
        activeTags = [];
        activeYear = 'all';
        
        // Reset tag buttons
        document.querySelectorAll('.filter-tag').forEach(btn => {
            if (btn.getAttribute('data-tag') === 'all') {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Reset selects
        const yearSelect = document.getElementById('year-filter');
        if (yearSelect) yearSelect.value = 'all';
        
        filterPosts();
    }
    
    function checkUrlParameters() {
        const urlParams = new URLSearchParams(window.location.search);
        const tagParam = urlParams.get('tag');
        
        if (tagParam) {
            toggleTagFilter(tagParam);
        }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFilters);
    } else {
        initFilters();
    }
})();
</script>
